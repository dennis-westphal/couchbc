<!DOCTYPE html>
<html lang="en">
<head>
	<title>CouchBC</title>
	<link href="/bundles/app.css" rel="stylesheet" type="text/css">
	<meta charset="UTF-8">
</head>
<body>
<div id="app">
	<nav>
		<div class="top-bar">
			<div class="top-bar-left">
				<a href="#" v-on:click.stop="page = 'start'" class="logo">CouchBC</a>

				<gmap-autocomplete
						id="search-address"
						:value="''"
						:placeholder="'Where do you want to go?'"
						:types="['(cities)']"
						@place_changed="changeSearchAddress">
				</gmap-autocomplete>
			</div>
			<div class="top-bar-right align-middle">
				<ul id="menu" class="dropdown menu" data-dropdown-menu>
					<li>
						<a href="#">Account</a>
						<ul>
							<li>
								<a href="#" v-on:click.stop="page = 'add-apartment'">
									Add apartment
								</a>
							</li>
							<li v-if="userApartments.length > 0">
								<a href="#" v-on:click.stop="page = 'user-apartments'">
									My apartments
								</a>
							</li>

							<li v-if="rentals.length > 0">
								<a href="#" v-on:click.stop="page = 'rentals'">
									My rentals
								</a>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="page start" v-if="page == 'start'">
		<header>
			<img :src="getImageUrl('Qma2jcNZYJ9FTUY5xA2iS6arL39usU5mg8fiLy3DseLiJz')">
			<div class="text">
				<h1>Time for a retreat</h1>
				<h2>Rent an apartment on CouchBC using blockchain technology</h2>
			</div>
		</header>
	</div>

	<div class="page apartments" v-if="page == 'apartments'">
		<div class="grid-x grid-padding-x">
			<div id="apartments" class="cell medium-7">
				<p>Found {{apartments.length}} apartment<span v-if="apartments.length != 1">s</span>
					in {{searchData.city}}, {{searchData.country}}</p>

				<div class="apartment" :id="'apartment-' + apartment.id" v-for="apartment in apartments"
				     v-on:click="showApartment(apartment)" :style="getApartmentStyle(apartment)">
					<div class="img">
						<img v-if="apartment.primaryImage" :src="getImageUrl(apartment.primaryImage)">
					</div>
					<div class="text">
						<p class="title">
							{{apartment.title|truncate(20)}}
							<span v-if="apartment.reviews.length > 0"
							      class="score"
							      v-bind:style="{backgroundImage: 'url(' + getImageUrl('QmepT6MmHFZTuhtaA7esu7GtD476UQUdXk3K2bWRi2Hmid') + ')', width: getStarsWidth(apartment.averageScore, 122) + 'px'}">
							</span>
						</p>
						<p>
							<span v-if="rentalRequestFrom && rentalRequestTill">
								{{getTotalPrice(apartment)}} per night
							</span>
							<span v-if="!(rentalRequestFrom && rentalRequestTill)">
								{{apartment.pricePerNight}} per night
							</span>
							/ {{apartment.deposit}} deposit
						</p>
					</div>
				</div>
			</div>
			<div class="cell medium-5">
				<gmap-map
						:center="{lat: searchData.latitude, lng: searchData.longitude}"
						:zoom="11"
						map-type-id="terrain"
						style="width: 100%; height: 100%; min-height: 300px; max-height:800px">
					<gmap-marker
							v-for="apartment in apartments"
							:key="apartment.id"
							:position="apartment.position"
							:clickable="true"
							@mouseover="highlightApartment(apartment)"
							@mouseout="unhighlightApartment(apartment)"
							@click="showApartment(apartment)"
					></gmap-marker>
				</gmap-map>
			</div>
		</div>
	</div>

	<div class="page apartment" v-if="page == 'apartment'">
		<div class="grid-container">
			<header>
				<vue-flux
						:options="fluxOptions"
						:images="getApartmentImages(rentalRequest.apartment)"
						:transitions="fluxTransitions"
						ref="slider">
				</vue-flux>
				<div class="text">
					<fieldset>
						<div class="form-control">
							<datepicker v-model="rentalRequestFrom" :disabled-dates="disabledDates"
							            :monday-first="true" placeholder="From"></datepicker>
						</div>
						<div class="form-control">
							<datepicker v-model="rentalRequestTill" :disabled-dates="disabledDates"
							            :monday-first="true" placeholder="Till"></datepicker>
						</div>
					</fieldset>

					<p class="fee">
						<span v-if="rentalRequest.fee > 0">
							Rental fee: {{rentalRequest.fee}} finney ({{finneyToEth(rentalRequest.fee)}} eth)<br/>
						</span>
						Deposit: {{rentalRequest.apartment.deposit}} finney ({{finneyToEth(rentalRequest.apartment.deposit)}} eth)
					</p>

					<fieldset>
						<div class="form-control">
							<input v-model="rentalRequest.name" placeholder="Your name" type="text">
						</div>
						<div class="form-control">
							<input v-model="rentalRequest.phone" placeholder="Telephone number" type="tel">
						</div>
						<div class="form-control">
							<input v-model="rentalRequest.email" placeholder="Email address" type="email">
						</div>
						<p class="privacy-hint">
							Your personal data will only be visible to the apartment owner and a mediator in case of a dispute
						</p>
					</fieldset>

					<a class="button">Request rental</a>
				</div>
			</header>

			<h1>{{rentalRequest.apartment.title}}</h1>
			<nl2br tag="p" :text="rentalRequest.apartment.description"></nl2br>

			<section class="reviews" v-if="rentalRequest.apartment.reviews.length > 0">
				<h3>Reviews</h3>
				<article v-for="review in rentalRequest.apartment.reviews">
					<span class="score"
					      v-bind:style="{backgroundImage: 'url(' + getImageUrl('QmepT6MmHFZTuhtaA7esu7GtD476UQUdXk3K2bWRi2Hmid') + ')', width: getStarsWidth(review.score, 122) + 'px'}"></span>

					<nl2br tag="p" :text="review.text"></nl2br>
				</article>
			</section>
		</div>
	</div>

	<div class="page add-apartment" v-if="page == 'add-apartment'">
		<form>
			<div class="grid-container">
				<h1>Add new apartment</h1>
				<div class="grid-x grid-padding-x">
					<div class="cell large-9 grid-x grid-padding-x">
						<div class="form-control cell">
							<label for="add-apartment-title">Title</label>
							<input id="add-apartment-title" type="text" name="title" v-model="newApartmentData.title">
						</div>
						<div class="form-control cell">
							<label for="add-apartment-description">Description</label>
							<textarea id="add-apartment-description" name="description"
							          v-model="newApartmentData.description"></textarea>
						</div>
						<div class="form-control cell">
							<label for="apartment-address">Address</label>
							<gmap-autocomplete
									id="apartment-address"
									:value="''"
									@place_changed="changeApartmentAddress">
							</gmap-autocomplete>
						</div>
						<div class="form-control cell large-6">
							<label for="add-apartment-pricePerNight">Price per night in finney</label>
							<input id="add-apartment-pricePerNight" type="number" name="pricePerNight"
							       v-model="newApartmentData.pricePerNight">
						</div>
						<div class="form-control cell large-6">
							<label for="add-apartment-deposit">Deposit in finney</label>
							<input id="add-apartment-deposit" type="number" name="deposit"
							       v-model="newApartmentData.deposit">
						</div>

						<div class="form-control cell image medium-6 large-4">
							<label for="add-apartment-primary-image">Primary image</label>
							<input id="add-apartment-primary-image" type="file" name="primaryImage"
							       v-on:change="changeImageSrc">
							<img class="preview" src="">
						</div>
						<div
								class="form-control cell image medium-6 large-4"
								v-for="(image, index) in newApartmentData.images">
							<label :for="'add-apartment-image-' + index">Image {{index + 2}}</label>
							<input :id="'add-apartment-image-' + index" class="add-image" type="file"
							       :name="'image-' + index" :data-index="index" v-on:change="changeImageSrc">
							<img class="preview" src="">
						</div>

						<div class="form-control cell">
							<div class="button add" v-on:click="newApartmentData.images.push('')">
								<span class="mdi mdi-plus-box"></span>
								Add image
							</div>
						</div>
					</div>
					<div id="account-selection" class="cell large-3">
						<h3>Account selection</h3>

						<div
								v-for="(account, index) in accounts"
								:class="{account: true, active: account == newApartmentData.account, forbidden: account.type == 'tenant' || account.type == 'interaction', rental: account.type == 'rental'}"
								:for="'account-' + index" class="account"
								v-on:click="selectNewApartmentAccount(account)">
							<span class="blockie" :style="getBlockie(account.address)"></span>
							<span v-if="account.type == 'owner'" class="mdi mdi-home-account tooltip"
							      title="This account is used for managing apartments"></span>
							<span v-if="account.type == 'tenant'" class="mdi mdi-account-card-details tooltip"
							      title="This account is used for managing rentals and thus cannot be used to add an apartment"></span>
							<span v-if="account.type == 'interaction'" class="mdi mdi-account-switch tooltip"
							      title="This account has been used in a rental and thus cannot be used for adding an apartment"></span>
							{{account.address.substr(0, 12)}}...{{account.address.substr(36)}}
						</div>
					</div>
				</div>

				<a class="button" v-on:click.stop="addApartment">Add apartment</a>
			</div>
		</form>
	</div>
</div>

<script src="/bundles/app.js"></script>
</body>
</html>
